!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).cmanvato=e()}}(function(){return function e(t,n,o){function i(r,s){if(!n[r]){if(!t[r]){var d="function"==typeof require&&require;if(!s&&d)return d(r,!0);if(a)return a(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return i(n||e)},c,c.exports,e,t,n,o)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,t,n){var o=e("./util/event-handler.js"),i=e("./load-players.js"),a=e("./extensions/metrics.js");t.exports={setup:function(){try{e("./extensions/new-relic.js"),e("./extensions/anvato-strategy.js"),window._cbv_strategies=window._cbv_strategies||[],window._cbv_strategies.push(window.AnvatoStrategy),e("./set-common-config.js"),a(),i()}catch(e){o.trigger("cmg/error",e)}},loadPlayers:i,setupMetrics:a,set:function(e,t){var n=window.anvp=window.anvp||{};n.common=n.common||{},n.common.config=n.common.config||{},n.common.config[e]=t},pauseAll:e("./pause-all.js"),on:o.on,one:o.one,off:o.off}},{"./extensions/anvato-strategy.js":2,"./extensions/metrics.js":5,"./extensions/new-relic.js":6,"./load-players.js":7,"./pause-all.js":8,"./set-common-config.js":9,"./util/event-handler.js":12}],2:[function(e,t,n){function o(e){this._player=e,this._isReady=!1,this._currentState=o.VideoState.UNPLAYED,this._currentTime=0,e.getThumbnail(function(e){this._thumbnailURL=e});var t=this;setInterval(function(){t._player.getCurrentTime(function(e){t._currentTime=e})},1),this.subscribeEvents()}window.AnvatoStrategy=o,o.prototype.subscribeEvents=function(){var e=this,t=this,n=this._player.listener;this._player.setListener(function(i){n&&n(i);t._title||t._player.getTitle(function(e){t._title=e});t._duration||t._player.getDuration(function(e){t._duration=e});t._thumbnailURL||t._player.getThumbnail(function(e){console.log("thumnail",e),t._thumbnailURL=e});switch(i.name){case"METADATA_LOADED":case"PROGRAM_CHANGED":e._updateMetadata(i);break;case"STATE_CHANGE":"pausedVideoContent"==i.args[0]?e._currentState=o.VideoState.STOPPED:"playingVideoContent"==i.args[0]&&(e._currentState=o.VideoState.PLAYED);break;case"PLAYING_START":e._viewStartTime||(e._viewStartTime=Date.now());break;case"VIDEO_COMPLETED":e._currentState=o.VideoState.COMPLETED;break;case"AD_STARTED":e._currentContentType=o.ContentType.AD,e._currentState=o.VideoState.PLAYED;break;case"VIDEO_STARTED":e._currentContentType=o.ContentType.CONTENT;break;case"FIRST_FRAME_READY":e._isReady=!0;break;case"CLIENT_BANDWIDTH":e._clientBandwidth=i.args[0];break;case"AD_TIME_UPDATED":e._currentContentType=o.ContentType.AD}})},o.prototype._updateMetadata=function(e){var t=e.args[0][2];this._title=t.title,this._duration=t.duration,this._thumbnailURL=t.thumbnail},o.prototype.getStrategyName=function(){return"AN"},o.ContentType={AD:"ad",CONTENT:"ct"},o.AdPosition={PREROLL:"a1",MIDROLL:"a2",POSTROLL:"a3",OVERLAY:"a4",SPECIAL:"a5"},o.VideoState={UNPLAYED:"s1",PLAYED:"s2",STOPPED:"s3",COMPLETED:"s4"},o.AutoplayType={UNKNOWN:"unkn",MANUAL:"man",AUTOPLAY:"auto",CONTINUOUS:"cont"},o.prototype.isReady=function(){return this._isReady},o.prototype.getTitle=function(){if(this._title)return this._title;var e=this._player.mergedConfig.title;return e?(this._title=e,e):void 0},o.prototype.getVideoPath=function(){return this._player.mergedConfig.video},o.prototype.getContentType=function(){return this._currentContentType||o.ContentType.CONTENT},o.prototype.getAdPosition=function(){},o.prototype.getTotalDuration=function(){return this._duration?1e3*this._duration:void 0},o.prototype.getState=function(){return this._currentState},o.prototype.getCurrentPlayTime=function(){return 1e3*this._currentTime},o.prototype.getBitrate=function(){return this._clientBandwidth},o.prototype.getThumbnailPath=function(){return this._thumbnailURL||""},o.prototype.getAutoplayType=function(){return o.AutoplayType.UNKNOWN},o.prototype.getPlayerType=function(){},o.prototype.getViewStartTime=function(){return this._viewStartTime?Date.now()-this._viewStartTime:0},o.prototype.getViewPlayTime=function(){},o.prototype.getViewAdPlayTime=function(){},o.verify=function(e){try{return e.mergedConfig.baseURL.indexOf("cdn.anvato.net")>=0}catch(e){return!1}}},{}],3:[function(e,t,n){var o=e("./cmg.js"),i=e("../util/environment-options.js"),a=e("../util/event-handler.js");t.exports=function(e,t,n,r,s,d){var u;if(o.adconf.adunit){try{var c=[].concat(o.adconf.targeting.topics,s,e.tags).toString(),p=[].concat(o.adconf.targeting.categories,d,e.categories).toString(),l=r||20;u={startTimeout:"startTimeout"in i?parseInt(i.startTimeout):l,vastLoadTimeout:"vastLoadTimeout"in i?parseInt(i.vastLoadTimeout):10,loadVideoTimeout:"loadVideoTimeout"in i?parseInt(i.loadVideoTimeout):10,adTagUrl:"https://pubads.g.doubleclick.net/gampad/ads?sz=400x300&iu=[adunit]&gdfp_req=1&env=vp&output=vast&description_url=[referrer_url]&content_page_url=[referrer_url]&vid=[vid]&cmsid=[cmsid]",keyValues:{category:p,video:e.upload_id,owner_id:e.owner_id,kw:c,topics:c,weather:o.adconf.targeting.weather,temp_range:o.adconf.targeting.temp_range,sky:o.adconf.targeting.sky,obj_type:o.adconf.targeting.obj_type,obj_id:o.adconf.targeting.obj_id,uuid:o.adconf.targeting.uuid,player_id:t,environ:o.adconf.targeting.environ},macros:{adunit:o.adconf.adunit,cmsid:n,vid:"ANV_ANV_"+e.upload_id,referrer_url:window.location.href}},console.info("\n/-------- VIDEO AD TARGETING --------/\n"+e.def_title+"\n"+JSON.stringify(u.keyValues,null,3)+"\n - Anvato MCP:\n\t[TAGS] "+e.tags+"\n\t[CATEGORIES] "+e.categories+"\n - Methode VPX:\n\t[TOPICS] "+s+"\n\t[CATEGORIES] "+d+"\n - Methode PAGE:\n\t[TOPICS] "+o.adconf.targeting.topics+"\n\t[CATEGORIES] "+o.adconf.targeting.categories)}catch(e){a.trigger("cmg/error",e)}return u}console.warn("[cmAnvato] Cannot find cm-ads! Video ad targeting is OFFLINE.")}},{"../util/environment-options.js":11,"../util/event-handler.js":12,"./cmg.js":4}],4:[function(e,t,n){var o=window.cmg=window.cmg||{};o.adconf=o.adconf||{},o.adconf.targeting=o.adconf.targeting||{},t.exports=o},{}],5:[function(e,t,n){var o=e("../util/event-handler.js"),i=window.pubsub,a=window.anvp=window.anvp||{};function r(e,t,n){window.payloadProcessing?window.queuedPayloads.push({e:e,metricEvent:t,ts:n}):s(e,t,n)}function s(e,t,n){window.payloadProcessing=!0,window.videoDataRequests[n]={},window.videoDataRequests[n].sender=e.sender,window.videoDataRequests[n].async=["title","time","duration"],window.videoDataRequests[n].payload={},window.videoDataRequests[n].event=t,window.videoDataRequests[n].event_fired=!1,window.videoDataRequests[n].titleFunc=function(e){window.videoDataRequests[n].payload.videoName=e,u("title",window.videoDataRequests[n].async),0!==window.videoDataRequests[n].async.length||window.videoDataRequests[n].event_fired||d(n)},window.videoDataRequests[n].timeFunc=function(e){window.videoDataRequests[n].payload.videoSecondsViewed=e,u("time",window.videoDataRequests[n].async),0!==window.videoDataRequests[n].async.length||window.videoDataRequests[n].event_fired||d(n)},window.videoDataRequests[n].durationFunc=function(e){window.videoDataRequests[n].payload.videoTotalTime=e,u("duration",window.videoDataRequests[n].async),0!==window.videoDataRequests[n].async.length||window.videoDataRequests[n].event_fired||d(n)},a[e.sender].getTitle(window.videoDataRequests[n].titleFunc),a[e.sender].getCurrentTime(window.videoDataRequests[n].timeFunc),a[e.sender].getDuration(window.videoDataRequests[n].durationFunc)}function d(e){var t=window.videoDataRequests[e].sender;window.videoDataRequests[e].event_fired=!0,window.videoDataRequests[e].payload.videoId=a[t].mergedConfig.video,window.videoDataRequests[e].payload.videoTopics=a[a[t].mergedConfig.video+"-topics"],window.videoDataRequests[e].payload.videoPlayer="Anvato Universal Player-"+a[t].mergedConfig.pInstance,window.videoDataRequests[e].payload.videoSiteAccountID=a[t].mergedConfig.accessKey,window.videoDataRequests[e].payload.videoPlayType=a[t].mergedConfig.autoplay?"auto-play":"manual play",window.videoDataRequests[e].payload.videoSource="Anvato",window.videoDataRequests[e].payload.videoContentType=a[t].mergedConfig.live?"live":"vod",i.publish(window.videoDataRequests[e].event,window.videoDataRequests[e].payload),window.payloadProcessing=!1,i.publish("payload_processing_complete")}function u(e,t){var n=t.indexOf(e);n>-1&&t.splice(n,1)}t.exports=function(){window.pubsub?(window.videoDataRequests=[],window.payloadProcessing=!1,window.queuedPayloads=[],a.listener=function(e){var t=a[e.sender];switch(o.trigger(e.name,e),e.name){case"METADATA_LOADED":e.args.hasOwnProperty(2)&&e.args[2].hasOwnProperty("tags")&&(a[e.args[1]+"-topics"]=e.args[2].tags);break;case"PLAYING_START":t.cmgVideoStart||(t.cmgVideoStart=!0,r(e,"video-start",Date.now()));break;case"VIDEO_STARTED":r(e,"video-content-play",Date.now());break;case"USER_PAUSE":r(e,"video-pause",Date.now());break;case"VIDEO_COMPLETED":t.cmgVideoStart=!1,r(e,"video-complete",Date.now())}},i.subscribe("payload_processing_complete",function(){window.queuedPayloads.length&&(s(window.queuedPayloads[0].e,window.queuedPayloads[0].metricEvent,window.queuedPayloads[0].ts),window.queuedPayloads.shift())})):console.warn("[cmAnvato] Cannot find PubSub! Video metrics are OFFLINE.")}},{"../util/event-handler.js":12}],6:[function(e,t,n){var o=e("../util/event-handler.js"),i=e("../util/environment-options.js"),a=performance.now(),r={};function s(e){var t=performance.now()-e;return Math.round(t/1e3*100)/100}o.on("cmg/error",function(e){console.error("[ANVATO ERROR]",e.name,e.message,e),window.newrelic&&window.newrelic.addPageAction("cmg_video_error",{cmg_video_id:e.name,cmg_video_message:e.message,cmg_video_uid:i.uid})}),o.on("AD_STARTED",function(e){window.newrelic&&window.newrelic.addPageAction("cmg_video_ad_started",{cmg_video_id:e.args[0],cmg_video_title:e.args[1],cmg_video_provider:e.args[2],cmg_video_load_time:s(r[e.sender]),cmg_video_timestamp:e.time,cmg_video_uid:i.uid})}),o.on("PLAYER_ERROR",function(e){"PLAY920"!==e.args[0]&&(console.error("[ANVATO ERROR]",e.args[0],e.args[1]),window.newrelic&&window.newrelic.addPageAction("cmg_video_error",{cmg_video_id:e.args[0],cmg_video_message:e.args[1],cmg_video_timestamp:e.time,cmg_video_uid:i.uid}))}),o.on("COMPONENTS_INITIALIZED",function(e){window.newrelic&&window.newrelic.addPageAction("cmg_video_player_load",{cmg_video_load_time:s(a),cmg_video_timestamp:e.time,cmg_video_uid:i.uid})}),o.on("USER_PLAY",function(e){window.newrelic&&(window.newrelic.addPageAction("cmg_video_play",{cmg_video_uid:i.uid}),r[e.sender]=performance.now())})},{"../util/environment-options.js":11,"../util/event-handler.js":12}],7:[function(e,t,n){var o=e("./setup-player.js"),i=e("./util/event-handler.js"),a=e("./util/environment-options.js").stage?"stage":"prod",r=e("./util/id-factory.js");t.exports=function(){var e=document.getElementsByClassName("anvato-player");if(e.length){var n=e[0].id="p"+r.next();o(n,e[0]),i.on("cmg/ready",function(e){e===window.anvp[n]&&t.exports()});var s=document.createElement("script");s.src="https://w3.cdn.anvato.net/player/"+a+"/v3/scripts/anvload.js",s.setAttribute("data-anvp",'{"pInstance":"'+n+'"}'),document.body.appendChild(s)}}},{"./setup-player.js":10,"./util/environment-options.js":11,"./util/event-handler.js":12,"./util/id-factory.js":13}],8:[function(e,t,n){t.exports=function(){var e=window.anvp=window.anvp||{};e.getAll&&e.getAll().forEach(function(t){var n=e[t];n&&n.pause&&n.pause()})}},{}],9:[function(e,t,n){var o=e("./util/map-merge-left.js"),i=window.anvp=window.anvp||{},a=window.DDO,r=e("./util/environment-options.js");i.common=i.common||{},i.common.config=o({token:" ",width:"100%",height:"56.25%",mcp:"anv",autoplay:!1,volume:"volume"in r?r.volume:.5,recom:!("recom"in r)||r.recom,plugins:{comscore:{clientId:6035944}},profile:"cox"},i.common.config),a&&a.pageData&&a.siteData&&a.contentData&&(i.common.config.customMetadata={video:{pageName:a.pageData.pageName,pageSiteSection:a.pageData.pageSiteSection,pageCategory:a.pageData.pageCategory,pageSubCategory:a.pageData.pageSubCategory,pageContentType:a.pageData.pageContentType,pageTitle:a.pageData.pageTitle,siteVersion:a.siteData.siteVersion,siteDomain:a.siteData.siteDomain,siteFormat:a.siteData.siteFormat,siteMetro:a.siteData.siteMetro,siteMedium:a.siteData.siteMedium,siteID:a.siteData.siteID,siteType:a.siteData.siteType,siteCMS:a.siteData.siteCMS,contentTopics:a.contentData.contentTopics,contentByline:a.contentData.contentByline,contentID:a.contentData.contentID,contentVendor:a.contentData.contentVendor},chapter:{},ad:{}})},{"./util/environment-options.js":11,"./util/map-merge-left.js":14}],10:[function(e,t,n){var o=e("./util/parse-settings.js"),i=e("./extensions/build-ad-config.js"),a=e("./util/scrub-metadata.js"),r=e("./util/event-handler.js"),s=e("./util/environment-options.js");t.exports=function(e,t){var n=window.anvp=window.anvp||{},d=o(t),u=0;n[e]={config:{accessKey:t.getAttribute("data-access-key"),video:t.getAttribute("data-videoid"),autoplay:d.autoplay},onReady:function(e){if(window._cbv=window._cbv||[],window._cbv.push(e),d.muted)try{e.mute()}catch(e){r.trigger("cmg/error",e)}r.trigger("cmg/ready",e)}},s.noads||(n[e].onBeforeVideoLoad=function(n){return u+=1,{plugins:{dfp:{clientSide:i(a(n),e,t.getAttribute("data-cmsid"),parseInt(t.getAttribute("data-dfp-timeout")),1===u?t.getAttribute("data-topics"):[],1===u?t.getAttribute("data-categories"):[])}}}})}},{"./extensions/build-ad-config.js":3,"./util/environment-options.js":11,"./util/event-handler.js":12,"./util/parse-settings.js":15,"./util/scrub-metadata.js":16}],11:[function(e,t,n){var o={},i={},a=window.location.search;(a=a.slice(1)).split("&").forEach(function(e){var t=e.split("="),n=t[0],i=t[1];o[n]=!i||window.decodeURIComponent(i)}),"anvato"in o&&o.anvato.split("|").forEach(function(e){e=e.split("-"),i[e[0]]=e[1]||!0}),t.exports=i},{}],12:[function(e,t,n){var o={},i={};t.exports={on:function(e,t){o[e]=o[e]||[],o[e].push(t)},one:function(e,t){i[e]=i[e]||[],i[e].push(t)},off:function(e){e?(o[e]=[],i[e]=[]):(o={},i={})},trigger:function(e,t){e in i&&(i[e].forEach(function(e){e(t)}),i[e]=[]),e in o&&o[e].forEach(function(e){e(t)})}}},{}],13:[function(e,t,n){var o=-1;t.exports={next:function(){return o+=1},current:function(){return o}}},{}],14:[function(e,t,n){t.exports=function(e,t){var n;for(n in e=e||{},t=t||{})e[n]=t[n];return e}},{}],15:[function(e,t,n){var o=e("./environment-options.js");t.exports=function(e){var t=e.getAttribute("data-topics")||"",n="true"===e.getAttribute("data-autoplay")||!1,i="true"===e.getAttribute("data-muted")||!1;return(t=t.split(",")).indexOf("autoplay-on-sound-on")>=0&&(n=!0,i=!1),{autoplay:"autoplay"in o?"true"===o.autoplay:n,muted:"mute"in o?"true"===o.mute:i}}},{"./environment-options.js":11}],16:[function(e,t,n){t.exports=function(e){return e.tags=e.tags||[],e.categories=e.categories||[],e.upload_id=e.upload_id||e.id||"ERROR",e.owner_id=e.owner_id||"ERROR",e}},{}]},{},[1])(1)});